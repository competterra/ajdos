<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <title>AJDOS Sensor Setup</title>  
  <link href="bootstrap.min.css" rel="stylesheet">
  <script src="ajdos-setup.js"></script>
</head>

<body onload="onload(); ">
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerMenu" aria-controls="navbarTogglerMenu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div id="navbarTogglerMenu" class="collapse navbar-collapse" >
        <span class="navbar-brand">AJDOS v1.0 Setup</span>
        <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
            <li id="menu_home" class="nav-item">
                <a class="nav-link" href="javascript:loadPage('home');">Home<span class="sr-only">(current)</span></a>
            </li>
            <li id="menu_measuring" class="nav-item">
              <a class="nav-link" href="javascript:loadPage('measuring');">Measuring</a>
            </li>
            <li id="menu_wifi" class="nav-item">
                <a class="nav-link" href="javascript:loadPage('wifi');">WIFI</a>
            </li>
            <li id="menu_send" class="nav-item">
                <a class="nav-link" href="javascript:loadPage('send');">Sending</a>
            </li>
            <li id="menu_send" class="nav-item">
              <a class="nav-link" href="javascript:loadPage('admin');">Admin</a>
            </li>
            <li id="menu_send" class="nav-item">
              <a class="nav-link" href="javascript:loadPage('test');">Test</a>
            </li>
        </ul>
    </div>
  </nav>

  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li id="breadcrumb" class="breadcrumb-item active" aria-current="page" id="breadcrumb">Home</li>
    </ol>
  </nav>

  <div class="container">
    <form action="" method="post" id="formMain" name="formMain">
      <div id="blank">
        
      </div>
    </form>
  </div>

  <hr/>

  <footer class="text-center">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <p>Copyright (c) 2021 Compet-Terra ltd.</p>
          <p style="color:#999; font-size: 0.8em;">Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:<br/></p>
          <p style="color:#aaa; font-size: 0.8em;">The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.<br/><br/>
            THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
          </p>
        </div>
      </div>
    </div>
  </footer>
  <div id="pageholder" style="display:none">

    <div id="pg_home" data-title="Home">
        <div class="jumbotron jumbotron">
            <div class="container-fluid">
              <h3 class="display-8">AJDOS <small>AIR POLLUTION SENSOR v1.0</small></h3>
              <form action="/set">
                <div class="form-row align-item-left my-2">
                  <div class="input-group">
                      <div class="input-group-prepend">
                          <div class="input-group-text"><span style="width:5rem; text-align:right;">Name</span></div>
                      </div>
                      <input id="set-main-name" type="text" class="form-control" placeholder="Sensor name">
                  </div>
                </div>
                <div class="form-row align-item-left my-2">
                  <div class="input-group">
                      <div class="input-group-prepend">
                          <div class="input-group-text"><span style="width:5rem; text-align:right;">Password</span></div>
                      </div>
                      <input id="set-main-password" type="text" class="form-control" placeholder="Sensor password">
                  </div>
                </div>
                <div class="form-row align-item-left my-2">
                  <div class="input-group">
                      <div class="input-group-prepend">
                          <div class="input-group-text"><span style="width:5rem; text-align:right;">Owner ID</span></div>
                      </div>
                      <input id="set-main-owner" type="text" class="form-control" placeholder="Owner id">
                  </div>
                </div>
                <div class="form-row align-item-left my-2">
                  <div class="input-group">
                      <div class="input-group-prepend">
                          <div class="input-group-text"><span style="width:5rem; text-align:right;">Station ID</span></div>
                      </div>
                      <input id="set-main-station" type="text" class="form-control" placeholder="Station id">
                  </div>
                </div>


                <div class="form-row align-item-left my-2">
                  <div class="input-group">
                      <div class="input-group-prepend">
                          <div class="input-group-text"><span style="width:5rem; text-align:right;">Lat.</span></div>
                      </div>
                      <input id="set-main-lat" type="text" class="form-control" placeholder="lattitude position">
                  </div>
                </div>
                <div class="form-row align-item-left my-2">
                  <div class="input-group">
                      <div class="input-group-prepend">
                          <div class="input-group-text"><span style="width:5rem; text-align:right;">Long.</span></div>
                      </div>
                      <input id="set-main-long" type="text" class="form-control" placeholder="longitude position">
                  </div>
                </div>
                <div class="form-row align-item-left my-2">
                  <div class="input-group">
                      <div class="input-group-prepend">
                          <div class="input-group-text"><span style="width:5rem; text-align:right;">Alt.</span></div>
                      </div>
                      <input id="set-main-alt" type="text" class="form-control" placeholder="altitude in meter">
                  </div>
                </div>
                <div class="form-row align-item-left my-2">
                  <div class="input-group">
                      <div class="input-group-prepend">
                          <div class="input-group-text"><span style="width:5rem; text-align:right;">Height</span></div>
                      </div>
                      <input id="set-main-height" type="text" class="form-control" placeholder="Ground height in meter">
                  </div>
                </div>

                <p id="msg-geo"></p>
                <div class="form-row d-flex justify-content-between my-4">
                  <button type="button" class="btn btn-info" onclick="getLocation();">Refresh</button>
                  <button type="button" class="btn btn-success" onclick="saveHome();">Save</button>
                </div>  
              </form>
            </div>
        </div>        
        <div id="connection-result" class="alert-light" role="alert"></div>
        <button id="btn_reboot" type="button" class="btn btn-warning btn-lg btn-block"  style="min-height: 4rem;"  onclick="showInfo('rebootInfo');">Reboot</button>
        <div id="rebootInfo" style="display: none;">
            <div class="card card-body">
              <h3>Reboot the sensor</h3>
              The present function will reboot the sensor in measuring mode.<br/><br/>
              <strong>Important: switch the DIP1 to ON and DIP2  to OFF before rebooting.</strong><br/>
              Please notice that the rebooting function is recommended to use only after a successful sensor test.<br/>
              After rebooting the sensor will start a measurement and the data will be sent to the given server.<br/>
              <div class="row d-flex justify-content-between my-4">
                <button type="button" class="btn btn-danger"  onclick="$('#rebootInfo').hide();">Cancel</button>
                <button type="button" class="btn btn-success" onclick="reboot();">Continue</button>
              </div>                            
            </div>
        </div><br/>
        <button id="btn_reset"  type="button" class="btn btn-danger  btn-lg btn-block"  style="min-height: 4rem;" onclick="showInfo('resetInfo');">Reset</button>
        <div id="resetInfo" style="display: none;">
            <div class="card card-body">
              <h3>Reset the sensor!</h3>
              This function will delete all data and settings from the sensor memory. Use this function when you want to stop the sensor.<br/>
              Running this function the sensor will log out from the server and reset itself.<br/>
            <div class="row d-flex justify-content-between my-4">
              <button type="button" class="btn btn-danger"  onclick="$('#resetInfo').hide();">Cancel</button>
              <button type="button" class="btn btn-success" onclick="resetsensor();">Continue</button>
            </div>                            
          </div>
        </div>

    </div>

    <div id="pg_measuring" data-title="Measuring">
      <h4>Measuring parameters</h4>
      <p>Specify measurement frequency</p>
      <form action="/set">

        <div class="row">
          <div class="col">
            <div class="input-group">
              <div class="input-group-prepend">
                  <div class="input-group-text"><span style="width:5rem; text-align:right;">Cycle</span></div>
              </div>
              <input id="set-measuring-cycle" type="number" class="form-control" placeholder="60" min="30" max="1440">
            </div>
          </div>
          <div class="col"><div class="input-group"><p style="margin: 0.4em 0 0 -1.5em;">minutes (30-1440)</p></div></div>          
        </div>

        <div class="row" style="margin-top: 0.4em;">
          <div class="col">
            <div class="input-group">
              <div class="input-group-prepend">
                  <div class="input-group-text"><span style="width:5rem; text-align:right;">Lag time</span></div>
              </div>
              <input id="set-measuring-lag" type="number" class="form-control" placeholder="1" min="0" max="180">
            </div>
          </div>
          <div class="col"><div class="input-group"><p style="margin: 0.4em 0 0 -1.5em;">seconds (0-180)</p></div></div>          
        </div>        
        <br/>

        <div class="form-row d-flex flex-row-reverse my-4">
          <button type="button" class="btn btn-success" onclick="saveMeasuring();">Save</button>
        </div>
      </form>
    </div>



    <div id="pg_wifi" data-title="WIFI">
       <h4>WIFI Router</h4>
       <p>Authorization data for the Internet access</p>
        <form action="/set">
            <div class="form-row align-item-left">
                <div class="input-group">
                    <div class="input-group-prepend">
                        <div class="input-group-text"><span style="width:5rem; text-align:right;">SSID</span></div>
                    </div>
                    <input id="set-wifi-ssid" type="text" class="form-control" placeholder="WIFI name">
                </div>
            </div>

            <div class="form-row align-item-left my-3">
                <div class="input-group">
                    <div class="input-group-prepend">
                        <div class="input-group-text"><span style="width:5rem; text-align:right;">Password</span></div>
                    </div>
                    <input id="set-wifi-pwd" type="text" class="form-control" placeholder="WIFI password">
                </div>
            </div>

            <div class="form-row d-flex justify-content-between my-4">
                <button type="button" class="btn btn-info" onclick="listWifiNetworks();">Show available wireless networks</button>
                <button type="button" class="btn btn-success" onclick="saveWifi();">Save</button>
            </div>

            <div class="form-row align-item-center my-2">
                <ul id="wireles-list" class="list-group w-100"></ul>
            </div>
        </form>
    </div>    

    <div id="pg_send" data-title="Sending">
      <h4>Server access</h4>
      <p>The measured data will be sent here</p>
      <form action="/set">
        <div class="form-row align-item-left">
          <div class="input-group">
            <div class="input-group-prepend">
                <div class="input-group-text"><span style="width:5rem; text-align:right;">Broker IP</span></div>
            </div>
            <input id="set-send-ip" type="text" class="form-control" placeholder="MQTT Broker IP">
          </div>
        </div>
        <div class="form-row align-item-left my-2">
          <div class="input-group">
            <div class="input-group-prepend">
                <div class="input-group-text"><span style="width:5rem; text-align:right;">Broker port</span></div>
            </div>
            <input id="set-send-port" type="number" class="form-control" placeholder="Broker port">
          </div>
        </div>        
        <br/>

        <div class="form-row align-item-left my-2">
          <div class="input-group">
              <div class="input-group-prepend">
                  <div class="input-group-text"><span style="width:5rem; text-align:right;">Username</span></div>
              </div>
              <input id="set-send-user" type="text" class="form-control" placeholder="user name">
          </div>
        </div>
    
        <div class="form-row align-item-left my-2">
          <div class="input-group">
              <div class="input-group-prepend">
                  <div class="input-group-text"><span style="width:5rem; text-align:right;">Password</span></div>
              </div>
              <input id="set-send-pwd" type="text" class="form-control" placeholder="user password">
          </div>
        </div>

        <div class="form-row d-flex flex-row-reverse my-4">
          <button type="button" class="btn btn-success" onclick="saveSend();">Save</button>
        </div>
      </form>
    </div>

    <div id="pg_admin" data-title="Admin">
      <h4>Configuration access</h4>
      <p>Password to access the sensor's WIFI</p>
      <div style="font-size:0.8em; color:#666;"></div>
      <form action="/set">
        
        <div class="form-row align-item-left my-2">
          <div class="input-group">
              <div class="input-group-prepend">
                  <div class="input-group-text"><span style="width:5rem; text-align:right;">Original</span></div>
              </div>
              <input id="set-admin-pwdold" type="password" class="form-control" placeholder="old password">
          </div>
        </div>

        <div class="form-row align-item-left my-2">
          <div class="input-group">
              <div class="input-group-prepend">
                  <div class="input-group-text"><span style="width:5rem; text-align:right;">New</span></div>
              </div>
              <input id="set-admin-pwd1" type="password" class="form-control" placeholder="new password">
          </div>
        </div>

        <div class="form-row align-item-left my-2">
          <div class="input-group">
              <div class="input-group-prepend">
                  <div class="input-group-text"><span style="width:5rem; text-align:right;">Again</span></div>
              </div>
              <input id="set-admin-pwd2" type="password" class="form-control" placeholder="retype the new password">
          </div>
        </div>
        

        <!--div class="form-row d-flex flex-row-reverse my-4"-->
        <div class="form-row d-flex justify-content-between my-4">
          <div><input id="chkSap" type="checkbox" onclick="showAdminPasswords();">&nbsp;Show passwords</div>
          <button type="button" class="btn btn-success" onclick="saveAdmin();">Save</button>
        </div>
      </form>
    </div>

    <div id="pg_test" data-title="Test">
      <form action="/set">

          <div class="form-row align-item-left my-3">
              <div class="input-group">
                  <div class="input-group-prepend">
                      <div class="input-group-text"><span style="width:5rem; text-align:right;">WIFI</span></div>
                  </div>
                  <input id="set-test-wifi" type="text" class="form-control" placeholder="WIFI test result" disabled>
              </div>
          </div>

          <div class="form-row align-item-left my-3">
            <div class="input-group">
                <div class="input-group-prepend">
                    <div class="input-group-text"><span style="width:5rem; text-align:right;">MQTT</span></div>
                </div>
                <input id="set-test-mqtt" type="text" class="form-control" placeholder="MQTT test result" disabled>
            </div>
        </div>

        <button id="btn_reboot" type="button" class="btn btn-Primary btn-lg btn-block" style="min-height: 4rem;" onclick="test();">Test connection</button>

      </form>
  </div>    

  <div id="pg_rebooting" data-title="reboot">
    <div class="jumbotron jumbotron">
      <div class="container-fluid">
        <h3 class="display-8">AJDOS <small>AIR POLLUTION SENSOR v1.0</small></h3>
        <p><strong>The sensor is rebooting in measuring mode...</strong></p>
        <p>If You want to return to the setup, turn the DIP2 switch to ON position and  connect to the "AJDOS-SENSOR" WiFi.<br/>
           Do not forget to disable the mobile internet before opening the <a href="http://ajdos.go">http://ajdos.go</a> (or http://192.168.1.1) site.</p>
      </div>
    </div>
  </div>

  <div id="pg_reseting" data-title="reset">
    <div class="jumbotron jumbotron">
      <div class="container-fluid">
        <h3 class="display-8">AJDOS <small>AIR POLLUTION SENSOR v1.0</small></h3>
        <p><strong>The system is reseting...</strong></p>
        <p>All stored data are removed and the parameters are reset to default.<br/>
           If You want to return to the setup, turn the DIP2 switch to ON position and  connect to the "AJDOS-SENSOR" WiFi.<br/>
           Do not forget to disable the mobile internet before opening the <a href="http://ajdos.go">http://ajdos.go</a> (or http://192.168.1.1) site.</p>
       </div>
    </div>
  </div>

  <div id="pg_testing" data-title="reset">
    <div class="jumbotron jumbotron">
      <div class="container-fluid">
        <h3 class="display-8">AJDOS <small>AIR POLLUTION SENSOR v1.0</small></h3>
        <p><strong>The sensor is testing...</strong></p>
        <p>The sensor will connect to the configured WiFi and the given server.<br/>
          The testing may take longer. During the test, the setup program will lost the connection to the sensor.<br/><br/>
          The setup program will try to connect to the sensor within 3 minutes, but you can do it manually by refreshing the browser.<br/>
          Upon test completion this setup program will give you the "test" option, where the testing result can be seen.</p>
      </div>
    </div>
  </div>



    <div id="template-wifi-item">
        <li id="wi-" class="list-group-item" onclick="selectWifi('wi-');"></li>
    </div>

  </div>

  <div id="modal-reading" class="modal-dialog modal-fullscreen" tabindex="-1" aria-hidden="true" style="background-color:yellow; position:absolute; top: 100px; z-index:999; display:none;">
    <div class="modal-header"><h5>Reading, please wait...</h5></div>
  </div>
  <div id="modal-saved" class="modal-dialog modal-fullscreen" tabindex="-1" aria-hidden="true" style="background-color:green; color: white; position:absolute; top: 100px; z-index:999; display:none;">
    <div class="modal-header"><h5>Saved</h5></div>
  </div>


  <script src="jquery-3.5.1.min.js"></script>
  <script src="bootstrap.min.js"></script>

</body>
</html>